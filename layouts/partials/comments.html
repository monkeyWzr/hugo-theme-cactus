{{ if (not (isset .Site.Params "comments")) }}
  {{ .Scratch.Set "enable_comments" false }}
{{ else if (isset .Params "comments") }}
  {{ .Scratch.Set "enable_comments" .Params.comments }}
{{ else if (isset .Site.Params.Comments "enabled") }}
  {{ .Scratch.Set "enable_comments" .Site.Params.Comments.Enabled }}
{{ else }}
  {{ .Scratch.Set "enable_comments" true }}
{{ end }}

{{ $enable_comments := .Scratch.Get "enable_comments" }}
{{ if $enable_comments }}
<hr>
  {{ if (or (not (isset .Site.Params.Comments "engine")) (eq .Site.Params.Comments.Engine "disqus")) }}
    <div class="blog-post-comments">
        <div id="disqus_thread">
          <script type="text/javascript">
          
          (function() {
              // Don't ever inject Disqus on localhost--it creates unwanted
              // discussions from 'localhost:1313' on your Disqus account...
              // if (window.location.hostname == "localhost")
              //     return;
          
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              var disqus_shortname = '{{ if .Site.DisqusShortname }}{{ .Site.DisqusShortname }}{{ else }}{{ .Site.Title }}{{ end }}';
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="https://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
    </div>

  {{ else if (eq .Site.Params.Comments.Engine "remark42") }}
      <div id="remark42"></div>
      <script type="text/javascript">
          {{ `// docs see here: https://github.com/umputun/remark42#comments` | safeJS }}
          var remark_config = {
              host: {{ .Site.Params.remark42.url | default "https://CHANGE.ME.IN.CONFIG.TOML" }},
              site_id: {{ .Site.Params.remark42.site_id | default "CHANGE ME IN CONFIG.TOML" }},
              components: ['embed'],
              url: {{ .Permalink }},
              max_shown_comments: {{ .Site.Params.remark42.max_comments | default 15 }},
              theme: {{ .Site.Params.remark42.theme | default "light" }},
              page_title: {{ .Title }},
              locale: {{ .Site.Params.remark42.locale | default "en" }},
              show_email_subscription: false,
              simple_view: {{ .Site.Params.remark42.simple_view | default false }}
          };
      </script>
      <script>
          ! function(e, n) {
              for (var o = 0; o < e.length; o++) {
                  var r = n.createElement("script"),
                      c = ".js",
                      d = n.head || n.body;
                  "noModule" in r ? (r.type = "module", c = ".mjs") : r.async = !0, r.defer = !0, r.src = remark_config.host + "/web/" + e[o] + c, d.appendChild(r)
              }
          }(remark_config.components || ["embed"], document);
      </script>
  {{ end }}
{{ end }}
