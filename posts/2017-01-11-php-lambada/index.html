<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>php的闭包特性 | Cactus theme example</title><link rel=canonical href=https://www.takuzen.me/hugo-theme-cactus/posts/2017-01-11-php-lambada/><meta name=description content="Hugo is a general-purpose website framework. Technically speaking, Hugo is a static site generator. Unlike systems that dynamically build a page with each visitor request, Hugo builds pages when you create or update your content. Since websites are viewed far more often than they are edited, Hugo is designed to provide an optimal viewing experience for your website’s end users and an ideal writing experience for website authors."><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="php的闭包特性"><meta property="og:description" content="闭包和匿名函数在PHP 5.3.0引入，并且PHP将两者视为相同的概念。闭包其实是伪装成函数的对象，它的实质其实是Closure实例。
创建闭包非常简单：
1$c = function($name) { 2 return sprintf(&#34;Hello World! Hello %s!&#34;, $name); 3}; 4 5echo $c('PHP'); 使用use对闭包附加状态，多个参数使用,分隔：
1function callPerson($name) { 2 return function($about) use ($name) { 3 return sprintf(&#34;%s, %s&#34;, $name, $about); 4 } 5} 6 7$triver = callPerson('Triver'); 8echo $triver(&#34;slow down, please!!&#34;); 9 附加的变量会被封装到闭包内，即使返回的闭包队形已经跳出了callPerson()的作用域也仍然会记住$name的值。
闭包有一个有趣的bindTo()方法，可以将闭包的内部状态绑定到其他对象上，第二个参数指定了绑定闭包的对象所属的类，从而实现在闭包中访问绑定对象的私有方法和属性。
1class Bind { 2 protected $name = 'no name'; 3 public $change; 4 5 public function addAction($action) { 6 $this->change = $action->bindTo($this, __CLASS__); 7 } 8} 9 10$bind = new Bind(); 11$bind->addAction(function() { 12 $this->name = &#34;php&#34;; 13 return $this->name; 14 }); 15 16$change = $bind->change; 17echo $change(); 使用这个特性可以方便的为类添加方法并绑定："><meta property="og:type" content="article"><meta property="og:url" content="https://www.takuzen.me/hugo-theme-cactus/posts/2017-01-11-php-lambada/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-01-11T18:39:17+00:00"><meta property="article:modified_time" content="2017-01-11T18:39:17+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="php的闭包特性"><meta name=twitter:description content="闭包和匿名函数在PHP 5.3.0引入，并且PHP将两者视为相同的概念。闭包其实是伪装成函数的对象，它的实质其实是Closure实例。
创建闭包非常简单：
1$c = function($name) { 2 return sprintf(&#34;Hello World! Hello %s!&#34;, $name); 3}; 4 5echo $c('PHP'); 使用use对闭包附加状态，多个参数使用,分隔：
1function callPerson($name) { 2 return function($about) use ($name) { 3 return sprintf(&#34;%s, %s&#34;, $name, $about); 4 } 5} 6 7$triver = callPerson('Triver'); 8echo $triver(&#34;slow down, please!!&#34;); 9 附加的变量会被封装到闭包内，即使返回的闭包队形已经跳出了callPerson()的作用域也仍然会记住$name的值。
闭包有一个有趣的bindTo()方法，可以将闭包的内部状态绑定到其他对象上，第二个参数指定了绑定闭包的对象所属的类，从而实现在闭包中访问绑定对象的私有方法和属性。
1class Bind { 2 protected $name = 'no name'; 3 public $change; 4 5 public function addAction($action) { 6 $this->change = $action->bindTo($this, __CLASS__); 7 } 8} 9 10$bind = new Bind(); 11$bind->addAction(function() { 12 $this->name = &#34;php&#34;; 13 return $this->name; 14 }); 15 16$change = $bind->change; 17echo $change(); 使用这个特性可以方便的为类添加方法并绑定："><link rel=stylesheet href=https://www.takuzen.me/hugo-theme-cactus/css/styles.d23bd7196808bd99fe59825763bf82094481bfa34a9dae09a0d5533e47dd4d51fac9ec450dedb08f25a476777eb202998613128da8c2012ca09fd736de1aeec3.css integrity="sha512-0jvXGWgIvZn+WYJXY7+CCUSBv6NKna4JoNVTPkfdTVH6yexFDe2wjyWkdnd+sgKZhhMSjajCASygn9c23hruww=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://www.takuzen.me/hugo-theme-cactus/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast')" style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/hugo-theme-cactus/>Home</a></li><li><a href=/hugo-theme-cactus/posts>Writings</a></li><li><a href=/hugo-theme-cactus/tags>Tags</a></li><li><a href=/hugo-theme-cactus/about>About</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://www.takuzen.me/hugo-theme-cactus/posts/2016-12-08-ruby-notes/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle()" onmouseout="$('#i-prev').toggle()"></i></a></li><li><a class=icon href=https://www.takuzen.me/hugo-theme-cactus/posts/2017-02-18-hash/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover="$('#i-next').toggle()" onmouseout="$('#i-next').toggle()"></i></a></li><li><a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle()" onmouseout="$('#i-top').toggle()"></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle()" onmouseout="$('#i-share').toggle()" onclick="return $('#share').toggle(),!1"></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fwww.takuzen.me%2fhugo-theme-cactus%2fposts%2f2017-01-11-php-lambada%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fwww.takuzen.me%2fhugo-theme-cactus%2fposts%2f2017-01-11-php-lambada%2f&text=php%e7%9a%84%e9%97%ad%e5%8c%85%e7%89%b9%e6%80%a7" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fwww.takuzen.me%2fhugo-theme-cactus%2fposts%2f2017-01-11-php-lambada%2f&title=php%e7%9a%84%e9%97%ad%e5%8c%85%e7%89%b9%e6%80%a7" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fwww.takuzen.me%2fhugo-theme-cactus%2fposts%2f2017-01-11-php-lambada%2f&is_video=false&description=php%e7%9a%84%e9%97%ad%e5%8c%85%e7%89%b9%e6%80%a7" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=php%e7%9a%84%e9%97%ad%e5%8c%85%e7%89%b9%e6%80%a7&body=Check out this article: https%3a%2f%2fwww.takuzen.me%2fhugo-theme-cactus%2fposts%2f2017-01-11-php-lambada%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fwww.takuzen.me%2fhugo-theme-cactus%2fposts%2f2017-01-11-php-lambada%2f&title=php%e7%9a%84%e9%97%ad%e5%8c%85%e7%89%b9%e6%80%a7" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fwww.takuzen.me%2fhugo-theme-cactus%2fposts%2f2017-01-11-php-lambada%2f&title=php%e7%9a%84%e9%97%ad%e5%8c%85%e7%89%b9%e6%80%a7" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fwww.takuzen.me%2fhugo-theme-cactus%2fposts%2f2017-01-11-php-lambada%2f&name=php%e7%9a%84%e9%97%ad%e5%8c%85%e7%89%b9%e6%80%a7&description=%e9%97%ad%e5%8c%85%e5%92%8c%e5%8c%bf%e5%90%8d%e5%87%bd%e6%95%b0%e5%9c%a8PHP%205.3.0%e5%bc%95%e5%85%a5%ef%bc%8c%e5%b9%b6%e4%b8%94PHP%e5%b0%86%e4%b8%a4%e8%80%85%e8%a7%86%e4%b8%ba%e7%9b%b8%e5%90%8c%e7%9a%84%e6%a6%82%e5%bf%b5%e3%80%82%e9%97%ad%e5%8c%85%e5%85%b6%e5%ae%9e%e6%98%af%e4%bc%aa%e8%a3%85%e6%88%90%e5%87%bd%e6%95%b0%e7%9a%84%e5%af%b9%e8%b1%a1%ef%bc%8c%e5%ae%83%e7%9a%84%e5%ae%9e%e8%b4%a8%e5%85%b6%e5%ae%9e%e6%98%afClosure%e5%ae%9e%e4%be%8b%e3%80%82%0a%e5%88%9b%e5%bb%ba%e9%97%ad%e5%8c%85%e9%9d%9e%e5%b8%b8%e7%ae%80%e5%8d%95%ef%bc%9a%0a1%24c%20%3d%20function%28%24name%29%20%7b%202%20return%20sprintf%28%26%2334%3bHello%20World%21%20Hello%20%25s%21%26%2334%3b%2c%20%24name%29%3b%203%7d%3b%204%205echo%20%24c%28%26%2339%3bPHP%26%2339%3b%29%3b%20%e4%bd%bf%e7%94%a8use%e5%af%b9%e9%97%ad%e5%8c%85%e9%99%84%e5%8a%a0%e7%8a%b6%e6%80%81%ef%bc%8c%e5%a4%9a%e4%b8%aa%e5%8f%82%e6%95%b0%e4%bd%bf%e7%94%a8%2c%e5%88%86%e9%9a%94%ef%bc%9a%0a1function%20callPerson%28%24name%29%20%7b%202%20return%20function%28%24about%29%20use%20%28%24name%29%20%7b%203%20return%20sprintf%28%26%2334%3b%25s%2c%20%25s%26%2334%3b%2c%20%24name%2c%20%24about%29%3b%204%20%7d%205%7d%206%207%24triver%20%3d%20callPerson%28%26%2339%3bTriver%26%2339%3b%29%3b%208echo%20%24triver%28%26%2334%3bslow%20down%2c%20please%21%21%26%2334%3b%29%3b%209%20%e9%99%84%e5%8a%a0%e7%9a%84%e5%8f%98%e9%87%8f%e4%bc%9a%e8%a2%ab%e5%b0%81%e8%a3%85%e5%88%b0%e9%97%ad%e5%8c%85%e5%86%85%ef%bc%8c%e5%8d%b3%e4%bd%bf%e8%bf%94%e5%9b%9e%e7%9a%84%e9%97%ad%e5%8c%85%e9%98%9f%e5%bd%a2%e5%b7%b2%e7%bb%8f%e8%b7%b3%e5%87%ba%e4%ba%86callPerson%28%29%e7%9a%84%e4%bd%9c%e7%94%a8%e5%9f%9f%e4%b9%9f%e4%bb%8d%e7%84%b6%e4%bc%9a%e8%ae%b0%e4%bd%8f%24name%e7%9a%84%e5%80%bc%e3%80%82%0a%e9%97%ad%e5%8c%85%e6%9c%89%e4%b8%80%e4%b8%aa%e6%9c%89%e8%b6%a3%e7%9a%84bindTo%28%29%e6%96%b9%e6%b3%95%ef%bc%8c%e5%8f%af%e4%bb%a5%e5%b0%86%e9%97%ad%e5%8c%85%e7%9a%84%e5%86%85%e9%83%a8%e7%8a%b6%e6%80%81%e7%bb%91%e5%ae%9a%e5%88%b0%e5%85%b6%e4%bb%96%e5%af%b9%e8%b1%a1%e4%b8%8a%ef%bc%8c%e7%ac%ac%e4%ba%8c%e4%b8%aa%e5%8f%82%e6%95%b0%e6%8c%87%e5%ae%9a%e4%ba%86%e7%bb%91%e5%ae%9a%e9%97%ad%e5%8c%85%e7%9a%84%e5%af%b9%e8%b1%a1%e6%89%80%e5%b1%9e%e7%9a%84%e7%b1%bb%ef%bc%8c%e4%bb%8e%e8%80%8c%e5%ae%9e%e7%8e%b0%e5%9c%a8%e9%97%ad%e5%8c%85%e4%b8%ad%e8%ae%bf%e9%97%ae%e7%bb%91%e5%ae%9a%e5%af%b9%e8%b1%a1%e7%9a%84%e7%a7%81%e6%9c%89%e6%96%b9%e6%b3%95%e5%92%8c%e5%b1%9e%e6%80%a7%e3%80%82%0a1class%20Bind%20%7b%202%20protected%20%24name%20%3d%20%26%2339%3bno%20name%26%2339%3b%3b%203%20public%20%24change%3b%204%205%20public%20function%20addAction%28%24action%29%20%7b%206%20%24this-%26gt%3bchange%20%3d%20%24action-%26gt%3bbindTo%28%24this%2c%20__CLASS__%29%3b%207%20%7d%208%7d%209%2010%24bind%20%3d%20new%20Bind%28%29%3b%2011%24bind-%26gt%3baddAction%28function%28%29%20%7b%2012%20%24this-%26gt%3bname%20%3d%20%26%2334%3bphp%26%2334%3b%3b%2013%20return%20%24this-%26gt%3bname%3b%2014%20%7d%29%3b%2015%2016%24change%20%3d%20%24bind-%26gt%3bchange%3b%2017echo%20%24change%28%29%3b%20%e4%bd%bf%e7%94%a8%e8%bf%99%e4%b8%aa%e7%89%b9%e6%80%a7%e5%8f%af%e4%bb%a5%e6%96%b9%e4%be%bf%e7%9a%84%e4%b8%ba%e7%b1%bb%e6%b7%bb%e5%8a%a0%e6%96%b9%e6%b3%95%e5%b9%b6%e7%bb%91%e5%ae%9a%ef%bc%9a" aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fwww.takuzen.me%2fhugo-theme-cactus%2fposts%2f2017-01-11-php-lambada%2f&t=php%e7%9a%84%e9%97%ad%e5%8c%85%e7%89%b9%e6%80%a7" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">php的闭包特性</h1><div class=meta><div class=postdate><time datetime="2017-01-11 18:39:17 +0000 UTC" itemprop=datePublished>2017-01-11</time></div><div class=article-read-time><i class="far fa-clock"></i>
3 minute read</div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/hugo-theme-cactus/tags/php rel=tag>php</a></div></div></header><div class=content itemprop=articleBody><p>闭包和匿名函数在<code>PHP 5.3.0</code>引入，并且PHP将两者视为相同的概念。闭包其实是伪装成函数的对象，它的实质其实是<code>Closure</code>实例。</p><p>创建闭包非常简单：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span style=color:#8be9fd;font-style:italic>$c</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>function</span>(<span style=color:#8be9fd;font-style:italic>$name</span>) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span>    <span style=color:#ff79c6>return</span> sprintf(<span style=color:#f1fa8c>&#34;Hello World! Hello %s!&#34;</span>, <span style=color:#8be9fd;font-style:italic>$name</span>);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span>};
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span style=color:#ff79c6>echo</span> <span style=color:#8be9fd;font-style:italic>$c</span>(<span style=color:#f1fa8c>&#39;PHP&#39;</span>);
</code></pre></div><p>使用<code>use</code>对闭包附加状态，多个参数使用<code>,</code>分隔：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span style=color:#ff79c6>function</span> <span style=color:#50fa7b>callPerson</span>(<span style=color:#8be9fd;font-style:italic>$name</span>) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span>    <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>function</span>(<span style=color:#8be9fd;font-style:italic>$about</span>) <span style=color:#ff79c6>use</span> (<span style=color:#8be9fd;font-style:italic>$name</span>) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span>        <span style=color:#ff79c6>return</span> sprintf(<span style=color:#f1fa8c>&#34;%s, %s&#34;</span>, <span style=color:#8be9fd;font-style:italic>$name</span>, <span style=color:#8be9fd;font-style:italic>$about</span>);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span>    }
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span>}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span style=color:#8be9fd;font-style:italic>$triver</span> <span style=color:#ff79c6>=</span> callPerson(<span style=color:#f1fa8c>&#39;Triver&#39;</span>);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span style=color:#ff79c6>echo</span> <span style=color:#8be9fd;font-style:italic>$triver</span>(<span style=color:#f1fa8c>&#34;slow down, please!!&#34;</span>);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span>
</code></pre></div><p>附加的变量会被封装到闭包内，即使返回的闭包队形已经跳出了<code>callPerson()</code>的作用域也仍然会记住<code>$name</code>的值。</p><p>闭包有一个有趣的<code>bindTo()</code>方法，可以将闭包的内部状态绑定到其他对象上，第二个参数指定了绑定闭包的对象所属的类，从而实现在闭包中访问绑定对象的私有方法和属性。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Bind</span> {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span>    <span style=color:#ff79c6>protected</span> <span style=color:#8be9fd;font-style:italic>$name</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;no name&#39;</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span>    <span style=color:#ff79c6>public</span> <span style=color:#8be9fd;font-style:italic>$change</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span>    <span style=color:#ff79c6>public</span> <span style=color:#ff79c6>function</span> <span style=color:#50fa7b>addAction</span>(<span style=color:#8be9fd;font-style:italic>$action</span>) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span>        <span style=color:#8be9fd;font-style:italic>$this</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>change</span> <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$action</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>bindTo</span>(<span style=color:#8be9fd;font-style:italic>$this</span>, __CLASS__);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>    }
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span>}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span style=color:#8be9fd;font-style:italic>$bind</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> Bind();
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span style=color:#8be9fd;font-style:italic>$bind</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>addAction</span>(<span style=color:#ff79c6>function</span>() {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span>    <span style=color:#8be9fd;font-style:italic>$this</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>name</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;php&#34;</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span>    <span style=color:#ff79c6>return</span> <span style=color:#8be9fd;font-style:italic>$this</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>name</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span>    });
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span style=color:#8be9fd;font-style:italic>$change</span> <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$bind</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>change</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span style=color:#ff79c6>echo</span> <span style=color:#8be9fd;font-style:italic>$change</span>();
</code></pre></div><p>使用这个特性可以方便的为类添加方法并绑定：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span style=color:#ff79c6>trait</span> MetaTrait
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span>{
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span>    <span style=color:#6272a4>//定义$methods数组,用于保存方法（函数）的名字和地址。
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span style=color:#6272a4></span>    <span style=color:#ff79c6>private</span> <span style=color:#8be9fd;font-style:italic>$methods</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>array</span>();
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span>    <span style=color:#6272a4>//定义addMethod方法，使用闭包类绑定匿名函数。
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span style=color:#6272a4></span>    <span style=color:#ff79c6>public</span> <span style=color:#ff79c6>function</span> <span style=color:#50fa7b>addMethod</span>(<span style=color:#8be9fd;font-style:italic>$methodName</span>, <span style=color:#8be9fd;font-style:italic>$methodCallable</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>    {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span>        <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>!</span>is_callable(<span style=color:#8be9fd;font-style:italic>$methodCallable</span>)) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span>            <span style=color:#ff79c6>throw</span> <span style=color:#ff79c6>new</span> InvalidArgumentException(<span style=color:#f1fa8c>&#39;Second param must be callable&#39;</span>);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span>        }
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span>        <span style=color:#8be9fd;font-style:italic>$this</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>methods</span>[<span style=color:#8be9fd;font-style:italic>$methodName</span>] <span style=color:#ff79c6>=</span> Closure<span style=color:#ff79c6>::</span><span style=color:#50fa7b>bind</span>(<span style=color:#8be9fd;font-style:italic>$methodCallable</span>, <span style=color:#8be9fd;font-style:italic>$this</span>, get_class());
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span>    }
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span>    <span style=color:#6272a4>//方法重载。为了避免当调用的方法不存在时产生错误，
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span style=color:#6272a4></span>    <span style=color:#6272a4>//可以使用 __call() 方法来避免。
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span style=color:#6272a4></span>    <span style=color:#ff79c6>public</span> <span style=color:#ff79c6>function</span> __call(<span style=color:#8be9fd;font-style:italic>$methodName</span>, <span style=color:#ff79c6>array</span> <span style=color:#8be9fd;font-style:italic>$args</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span>    {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span>        <span style=color:#ff79c6>if</span> (isset(<span style=color:#8be9fd;font-style:italic>$this</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>methods</span>[<span style=color:#8be9fd;font-style:italic>$methodName</span>])) {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span>            <span style=color:#ff79c6>return</span> call_user_func_array(<span style=color:#8be9fd;font-style:italic>$this</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>methods</span>[<span style=color:#8be9fd;font-style:italic>$methodName</span>], <span style=color:#8be9fd;font-style:italic>$args</span>);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span>        }
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span>        <span style=color:#ff79c6>throw</span> RunTimeException(<span style=color:#f1fa8c>&#39;There is no method with the given name to call&#39;</span>);
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span>    }
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span>}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>HackThursday</span> {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span>    <span style=color:#ff79c6>use</span> MetaTrait;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span>    <span style=color:#ff79c6>private</span> <span style=color:#8be9fd;font-style:italic>$dayOfWeek</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;Thursday&#39;</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span>}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span style=color:#8be9fd;font-style:italic>$test</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> HackThursday();
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span style=color:#8be9fd;font-style:italic>$test</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>addMethod</span>(<span style=color:#f1fa8c>&#39;when&#39;</span>, <span style=color:#ff79c6>function</span> () {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span>    <span style=color:#ff79c6>return</span> <span style=color:#8be9fd;font-style:italic>$this</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>dayOfWeek</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span>});
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span style=color:#ff79c6>echo</span> <span style=color:#8be9fd;font-style:italic>$test</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>when</span>();
</code></pre></div><p>php7 中增加了 <code>Closure::call()</code> 方法，可以更高效的绑定对象作用域并调用。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>A</span> {<span style=color:#ff79c6>private</span> <span style=color:#8be9fd;font-style:italic>$x</span> <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1</span>;}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span style=color:#6272a4>// Pre PHP 7 code
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>$getXCB</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>function</span>() {<span style=color:#ff79c6>return</span> <span style=color:#8be9fd;font-style:italic>$this</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>x</span>;};
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span style=color:#8be9fd;font-style:italic>$getX</span> <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$getXCB</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>bindTo</span>(<span style=color:#ff79c6>new</span> A, <span style=color:#f1fa8c>&#39;A&#39;</span>); <span style=color:#6272a4>// intermediate closure
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span style=color:#6272a4></span><span style=color:#ff79c6>echo</span> <span style=color:#8be9fd;font-style:italic>$getX</span>();
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span style=color:#6272a4>// PHP 7+ code
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>$getX</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>function</span>() {<span style=color:#ff79c6>return</span> <span style=color:#8be9fd;font-style:italic>$this</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>x</span>;};
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span style=color:#ff79c6>echo</span> <span style=color:#8be9fd;font-style:italic>$getX</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>call</span>(<span style=color:#ff79c6>new</span> A);
</code></pre></div></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/hugo-theme-cactus/>Home</a></li><li><a href=/hugo-theme-cactus/posts>Writings</a></li><li><a href=/hugo-theme-cactus/tags>Tags</a></li><li><a href=/hugo-theme-cactus/about>About</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fwww.takuzen.me%2fhugo-theme-cactus%2fposts%2f2017-01-11-php-lambada%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fwww.takuzen.me%2fhugo-theme-cactus%2fposts%2f2017-01-11-php-lambada%2f&text=php%e7%9a%84%e9%97%ad%e5%8c%85%e7%89%b9%e6%80%a7" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fwww.takuzen.me%2fhugo-theme-cactus%2fposts%2f2017-01-11-php-lambada%2f&title=php%e7%9a%84%e9%97%ad%e5%8c%85%e7%89%b9%e6%80%a7" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fwww.takuzen.me%2fhugo-theme-cactus%2fposts%2f2017-01-11-php-lambada%2f&is_video=false&description=php%e7%9a%84%e9%97%ad%e5%8c%85%e7%89%b9%e6%80%a7" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=php%e7%9a%84%e9%97%ad%e5%8c%85%e7%89%b9%e6%80%a7&body=Check out this article: https%3a%2f%2fwww.takuzen.me%2fhugo-theme-cactus%2fposts%2f2017-01-11-php-lambada%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fwww.takuzen.me%2fhugo-theme-cactus%2fposts%2f2017-01-11-php-lambada%2f&title=php%e7%9a%84%e9%97%ad%e5%8c%85%e7%89%b9%e6%80%a7" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fwww.takuzen.me%2fhugo-theme-cactus%2fposts%2f2017-01-11-php-lambada%2f&title=php%e7%9a%84%e9%97%ad%e5%8c%85%e7%89%b9%e6%80%a7" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fwww.takuzen.me%2fhugo-theme-cactus%2fposts%2f2017-01-11-php-lambada%2f&name=php%e7%9a%84%e9%97%ad%e5%8c%85%e7%89%b9%e6%80%a7&description=%e9%97%ad%e5%8c%85%e5%92%8c%e5%8c%bf%e5%90%8d%e5%87%bd%e6%95%b0%e5%9c%a8PHP%205.3.0%e5%bc%95%e5%85%a5%ef%bc%8c%e5%b9%b6%e4%b8%94PHP%e5%b0%86%e4%b8%a4%e8%80%85%e8%a7%86%e4%b8%ba%e7%9b%b8%e5%90%8c%e7%9a%84%e6%a6%82%e5%bf%b5%e3%80%82%e9%97%ad%e5%8c%85%e5%85%b6%e5%ae%9e%e6%98%af%e4%bc%aa%e8%a3%85%e6%88%90%e5%87%bd%e6%95%b0%e7%9a%84%e5%af%b9%e8%b1%a1%ef%bc%8c%e5%ae%83%e7%9a%84%e5%ae%9e%e8%b4%a8%e5%85%b6%e5%ae%9e%e6%98%afClosure%e5%ae%9e%e4%be%8b%e3%80%82%0a%e5%88%9b%e5%bb%ba%e9%97%ad%e5%8c%85%e9%9d%9e%e5%b8%b8%e7%ae%80%e5%8d%95%ef%bc%9a%0a1%24c%20%3d%20function%28%24name%29%20%7b%202%20return%20sprintf%28%26%2334%3bHello%20World%21%20Hello%20%25s%21%26%2334%3b%2c%20%24name%29%3b%203%7d%3b%204%205echo%20%24c%28%26%2339%3bPHP%26%2339%3b%29%3b%20%e4%bd%bf%e7%94%a8use%e5%af%b9%e9%97%ad%e5%8c%85%e9%99%84%e5%8a%a0%e7%8a%b6%e6%80%81%ef%bc%8c%e5%a4%9a%e4%b8%aa%e5%8f%82%e6%95%b0%e4%bd%bf%e7%94%a8%2c%e5%88%86%e9%9a%94%ef%bc%9a%0a1function%20callPerson%28%24name%29%20%7b%202%20return%20function%28%24about%29%20use%20%28%24name%29%20%7b%203%20return%20sprintf%28%26%2334%3b%25s%2c%20%25s%26%2334%3b%2c%20%24name%2c%20%24about%29%3b%204%20%7d%205%7d%206%207%24triver%20%3d%20callPerson%28%26%2339%3bTriver%26%2339%3b%29%3b%208echo%20%24triver%28%26%2334%3bslow%20down%2c%20please%21%21%26%2334%3b%29%3b%209%20%e9%99%84%e5%8a%a0%e7%9a%84%e5%8f%98%e9%87%8f%e4%bc%9a%e8%a2%ab%e5%b0%81%e8%a3%85%e5%88%b0%e9%97%ad%e5%8c%85%e5%86%85%ef%bc%8c%e5%8d%b3%e4%bd%bf%e8%bf%94%e5%9b%9e%e7%9a%84%e9%97%ad%e5%8c%85%e9%98%9f%e5%bd%a2%e5%b7%b2%e7%bb%8f%e8%b7%b3%e5%87%ba%e4%ba%86callPerson%28%29%e7%9a%84%e4%bd%9c%e7%94%a8%e5%9f%9f%e4%b9%9f%e4%bb%8d%e7%84%b6%e4%bc%9a%e8%ae%b0%e4%bd%8f%24name%e7%9a%84%e5%80%bc%e3%80%82%0a%e9%97%ad%e5%8c%85%e6%9c%89%e4%b8%80%e4%b8%aa%e6%9c%89%e8%b6%a3%e7%9a%84bindTo%28%29%e6%96%b9%e6%b3%95%ef%bc%8c%e5%8f%af%e4%bb%a5%e5%b0%86%e9%97%ad%e5%8c%85%e7%9a%84%e5%86%85%e9%83%a8%e7%8a%b6%e6%80%81%e7%bb%91%e5%ae%9a%e5%88%b0%e5%85%b6%e4%bb%96%e5%af%b9%e8%b1%a1%e4%b8%8a%ef%bc%8c%e7%ac%ac%e4%ba%8c%e4%b8%aa%e5%8f%82%e6%95%b0%e6%8c%87%e5%ae%9a%e4%ba%86%e7%bb%91%e5%ae%9a%e9%97%ad%e5%8c%85%e7%9a%84%e5%af%b9%e8%b1%a1%e6%89%80%e5%b1%9e%e7%9a%84%e7%b1%bb%ef%bc%8c%e4%bb%8e%e8%80%8c%e5%ae%9e%e7%8e%b0%e5%9c%a8%e9%97%ad%e5%8c%85%e4%b8%ad%e8%ae%bf%e9%97%ae%e7%bb%91%e5%ae%9a%e5%af%b9%e8%b1%a1%e7%9a%84%e7%a7%81%e6%9c%89%e6%96%b9%e6%b3%95%e5%92%8c%e5%b1%9e%e6%80%a7%e3%80%82%0a1class%20Bind%20%7b%202%20protected%20%24name%20%3d%20%26%2339%3bno%20name%26%2339%3b%3b%203%20public%20%24change%3b%204%205%20public%20function%20addAction%28%24action%29%20%7b%206%20%24this-%26gt%3bchange%20%3d%20%24action-%26gt%3bbindTo%28%24this%2c%20__CLASS__%29%3b%207%20%7d%208%7d%209%2010%24bind%20%3d%20new%20Bind%28%29%3b%2011%24bind-%26gt%3baddAction%28function%28%29%20%7b%2012%20%24this-%26gt%3bname%20%3d%20%26%2334%3bphp%26%2334%3b%3b%2013%20return%20%24this-%26gt%3bname%3b%2014%20%7d%29%3b%2015%2016%24change%20%3d%20%24bind-%26gt%3bchange%3b%2017echo%20%24change%28%29%3b%20%e4%bd%bf%e7%94%a8%e8%bf%99%e4%b8%aa%e7%89%b9%e6%80%a7%e5%8f%af%e4%bb%a5%e6%96%b9%e4%be%bf%e7%9a%84%e4%b8%ba%e7%b1%bb%e6%b7%bb%e5%8a%a0%e6%96%b9%e6%b3%95%e5%b9%b6%e7%bb%91%e5%ae%9a%ef%bc%9a" aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fwww.takuzen.me%2fhugo-theme-cactus%2fposts%2f2017-01-11-php-lambada%2f&t=php%e7%9a%84%e9%97%ad%e5%8c%85%e7%89%b9%e6%80%a7" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick="return $('#nav-footer').toggle(),!1" aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick="return $('#toc-footer').toggle(),!1" aria-label=TOC><i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick="return $('#share-footer').toggle(),!1" aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2021 You</div><div class=footer-right><nav><ul><li><a href=/hugo-theme-cactus/>Home</a></li><li><a href=/hugo-theme-cactus/posts>Writings</a></li><li><a href=/hugo-theme-cactus/tags>Tags</a></li><li><a href=/hugo-theme-cactus/about>About</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/hugo-theme-cactus/lib/font-awesome/css/all.min.css><script src=/hugo-theme-cactus/lib/jquery/jquery.min.js></script><script src=/hugo-theme-cactus/js/main.js></script><script src=/hugo-theme-cactus/js/code-copy.js></script></html>